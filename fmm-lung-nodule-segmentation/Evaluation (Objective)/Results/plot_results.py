#!/usr/bin/env python
#from __future__ import print_function
import sys
import math
import matplotlib
import matplotlib.pyplot as plt
import numpy as np
import matplotlib.patches as mpatches
from matplotlib.ticker import (MultipleLocator, FormatStrFormatter,AutoMinorLocator,PercentFormatter)

def signif(x, digits=3):
    if x == 0 or not math.isfinite(x):
        return x
    digits -= math.ceil(math.log10(abs(x)))
    return round(x, digits)

stringhette = ["Round","Semi-transparent","Cavitary","Irregular"]
for stringhetta in stringhette:
    INPUT_FOLDER = stringhetta#sys.argv[1]

    """for i in range(0,18):
        print("iou_fmm["+str(i)+"],",end="")
    exit()"""
    labels = []
    iou_fmm = []
    iou_ac = []
    scores_list = []
    longerr_fmm = []
    longerr_ac = []
    shorterr_fmm = []
    shorterr_ac = []

    scores = open(INPUT_FOLDER+"/scores.txt")
    for f in scores:
        scores_list.append(f[:-1].split("&"))
    scores_list.sort()
    for s in scores_list:
        iou_fmm.append(float(s[1]))
        iou_ac.append(float(s[4]))
        longerr_fmm.append(float(s[2]))
        longerr_ac.append(float(s[5]))
        shorterr_fmm.append(float(s[3]))
        shorterr_ac.append(float(s[6]))

    if INPUT_FOLDER[-1] == "/":
        INPUT_FOLDER = INPUT_FOLDER[:-1]
    if INPUT_FOLDER[:5] == "Round" or INPUT_FOLDER[:5] == "Irreg":
        n = len(scores_list)
        iou_fmm1 = iou_fmm[:n//2]
        iou_fmm2 = iou_fmm[n//2:]
        iou_ac1 = iou_ac[:n//2]
        iou_ac2 = iou_ac[n//2:]
        longerr_fmm1 = longerr_fmm[:n//2]
        longerr_fmm2 = longerr_fmm[n//2:]
        longerr_ac1 = longerr_ac[:n//2]
        longerr_ac2 = longerr_ac[n//2:]
        shorterr_fmm1 = shorterr_fmm[:n//2]
        shorterr_fmm2 = shorterr_fmm[n//2:]
        shorterr_ac1 = shorterr_ac[:n//2]
        shorterr_ac2 = shorterr_ac[n//2:]
        x1 = np.arange(1,n/2+1,1)
        x2 = np.arange(n/2+1,n+1,1)

        fig,ax = plt.subplots()
        ax.plot(x1, iou_fmm1, 'ro--', linewidth=1, markersize=5)
        ax.plot(x1, iou_ac1, 'bo--', linewidth=1, markersize=5)
        ax.set_xlim((1, n/2))
        plt.ylim((0, 1))
        plt.xticks(x1)
        plt.ylabel("IoU",fontsize=16)
        plt.xlabel("Index",fontsize=16)
        red_patch = mpatches.Patch(color='red', label='FMM')
        blue_patch = mpatches.Patch(color='blue', label='AC')
        plt.legend(handles=[blue_patch,red_patch])
        ax.yaxis.set_major_locator(MultipleLocator(0.1))
        ax.yaxis.set_minor_locator(MultipleLocator(0.05))
        plt.grid(which='both')
        plt.savefig("Graphs/"+INPUT_FOLDER+"_iou_graph_1.png",bbox_inches='tight',pad_inches=0.01)
        print("\\begin{figure}[h!]")
        print("\\centering")
        print("\\includegraphics[width=0.9\linewidth]{img/"+INPUT_FOLDER+"_iou_graph_1.png}")
        print("\\caption{"+INPUT_FOLDER+" - Intersection over Union (1/2)}")
        print("\\label{fig:"+INPUT_FOLDER+"_iou_graph_1}")
        print("\\end{figure}")
        print("")
        fig,ax = plt.subplots()
        ax.plot(x2, iou_fmm2, 'ro--', linewidth=1, markersize=5)
        ax.plot(x2, iou_ac2, 'bo--', linewidth=1, markersize=5)
        ax.set_xlim((n/2+1, n))
        plt.ylim((0, 1))
        plt.xticks(x2)
        plt.ylabel("IoU",fontsize=16)
        plt.xlabel("Index",fontsize=16)
        red_patch = mpatches.Patch(color='red', label='FMM')
        blue_patch = mpatches.Patch(color='blue', label='AC')
        plt.legend(handles=[blue_patch,red_patch])
        ax.yaxis.set_major_locator(MultipleLocator(0.1))
        ax.yaxis.set_minor_locator(MultipleLocator(0.05))
        plt.grid(which='both')
        plt.savefig("Graphs/"+INPUT_FOLDER+"_iou_graph_2.png",bbox_inches='tight',pad_inches=0.01)
        print("\\begin{figure}[h!]")
        print("\\centering")
        print("\\includegraphics[width=0.9\linewidth]{img/"+INPUT_FOLDER+"_iou_graph_2.png}")
        print("\\caption{"+INPUT_FOLDER+" - Intersection over Union (2/2)}")
        print("\\label{fig:"+INPUT_FOLDER+"_iou_graph_2}")
        print("\\end{figure}")
        print("")
        fig,ax = plt.subplots(1,1)
        ax.plot(x1, longerr_fmm1, 'ro--', linewidth=1, markersize=5)
        ax.plot(x1, longerr_ac1, 'bo--', linewidth=1, markersize=5)
        ax.set_xlim((1, n/2))
        ax.set_ylim(bottom=0)
        ax.yaxis.set_major_formatter(PercentFormatter())
        ax.set_xticks(x1)
        ax.set_ylabel("Long-axis relative error",fontsize=16)
        ax.set_xlabel("Index",fontsize=16)
        red_patch = mpatches.Patch(color='red', label='FMM')
        blue_patch = mpatches.Patch(color='blue', label='AC')
        ax.legend(handles=[blue_patch,red_patch])
        ax.yaxis.set_major_locator(MultipleLocator(20))
        ax.yaxis.set_minor_locator(MultipleLocator(10))
        ax.grid(which='both')
        plt.savefig("Graphs/"+INPUT_FOLDER+"_longerr_graph_1.png",bbox_inches='tight',pad_inches=0.01)
        print("\\begin{figure}[h!]")
        print("\\centering")
        print("\\includegraphics[width=0.9\linewidth]{img/"+INPUT_FOLDER+"_longerr_graph_1.png}")
        print("\\caption{"+INPUT_FOLDER+" - Long-axis relative error (1/2)}")
        print("\\label{fig:"+INPUT_FOLDER+"_longerr_graph_1}")
        print("\\end{figure}")
        print("")
        fig,ax = plt.subplots(1,1)
        ax.plot(x2, longerr_fmm2, 'ro--', linewidth=1, markersize=5)
        ax.plot(x2, longerr_ac2, 'bo--', linewidth=1, markersize=5)
        ax.set_xlim((n/2+1, n))
        ax.set_ylim(bottom=0)
        ax.yaxis.set_major_formatter(PercentFormatter())
        ax.set_xticks(x2)
        ax.set_ylabel("Long-axis relative error",fontsize=16)
        ax.set_xlabel("Index",fontsize=16)
        red_patch = mpatches.Patch(color='red', label='FMM')
        blue_patch = mpatches.Patch(color='blue', label='AC')
        ax.legend(handles=[blue_patch,red_patch])
        ax.yaxis.set_major_locator(MultipleLocator(20))
        ax.yaxis.set_minor_locator(MultipleLocator(10))
        ax.grid(which='both')
        plt.savefig("Graphs/"+INPUT_FOLDER+"_longerr_graph_2.png",bbox_inches='tight',pad_inches=0.01)
        print("\\begin{figure}[h!]")
        print("\\centering")
        print("\\includegraphics[width=0.9\linewidth]{img/"+INPUT_FOLDER+"_longerr_graph_2.png}")
        print("\\caption{"+INPUT_FOLDER+" - Long-axis relative error (2/2)}")
        print("\\label{fig:"+INPUT_FOLDER+"_longerr_graph_2}")
        print("\\end{figure}")
        print("")
        fig,ax = plt.subplots(1,1)
        ax.plot(x1, shorterr_fmm1, 'ro--', linewidth=1, markersize=5)
        ax.plot(x1, shorterr_ac1, 'bo--', linewidth=1, markersize=5)
        ax.set_xlim((1, n/2))
        ax.set_ylim(bottom=0)
        ax.yaxis.set_major_formatter(PercentFormatter())
        ax.set_xticks(x1)
        ax.set_ylabel("Short-axis relative error",fontsize=16)
        ax.set_xlabel("Index",fontsize=16)
        red_patch = mpatches.Patch(color='red', label='FMM')
        blue_patch = mpatches.Patch(color='blue', label='AC')
        ax.legend(handles=[blue_patch,red_patch])
        ax.yaxis.set_major_locator(MultipleLocator(20))
        ax.yaxis.set_minor_locator(MultipleLocator(10))
        ax.grid(which='both')
        plt.savefig("Graphs/"+INPUT_FOLDER+"_shorterr_graph_1.png",bbox_inches='tight',pad_inches=0.01)
        print("\\begin{figure}[h!]")
        print("\\centering")
        print("\\includegraphics[width=0.9\linewidth]{img/"+INPUT_FOLDER+"_shorterr_graph_1.png}")
        print("\\caption{"+INPUT_FOLDER+" - Short-axis relative error (1/2)}")
        print("\\label{fig:"+INPUT_FOLDER+"_shorterr_graph_1}")
        print("\\end{figure}")
        print("")
        fig,ax = plt.subplots(1,1)
        ax.plot(x2, shorterr_fmm2, 'ro--', linewidth=1, markersize=5)
        ax.plot(x2, shorterr_ac2, 'bo--', linewidth=1, markersize=5)
        ax.set_xlim((n/2+1, n))
        ax.set_ylim(bottom=0)
        ax.yaxis.set_major_formatter(PercentFormatter())
        ax.set_xticks(x2)
        ax.set_ylabel("Short-axis relative error",fontsize=16)
        ax.set_xlabel("Index",fontsize=16)
        red_patch = mpatches.Patch(color='red', label='FMM')
        blue_patch = mpatches.Patch(color='blue', label='AC')
        ax.legend(handles=[blue_patch,red_patch])
        ax.yaxis.set_major_locator(MultipleLocator(20))
        ax.yaxis.set_minor_locator(MultipleLocator(10))
        ax.grid(which='both')
        plt.savefig("Graphs/"+INPUT_FOLDER+"_shorterr_graph_2.png",bbox_inches='tight',pad_inches=0.01)
        print("\\begin{figure}[h!]")
        print("\\centering")
        print("\\includegraphics[width=0.9\linewidth]{img/"+INPUT_FOLDER+"_shorterr_graph_2.png}")
        print("\\caption{"+INPUT_FOLDER+" - Short-axis relative error (2/2)}")
        print("\\label{fig:"+INPUT_FOLDER+"_shorterr_graph_2}")
        print("\\end{figure}")
        print("")
    else:
        n = len(scores_list)
        x = np.arange(1,n+1,1)

        fig,ax = plt.subplots(1,1)
        ax.plot(x, iou_fmm, 'ro--', linewidth=1, markersize=5)
        ax.plot(x, iou_ac, 'bo--', linewidth=1, markersize=5)
        ax.set_xlim((1, n))
        ax.set_ylim((0, 1))
        ax.set_xticks(x)
        ax.set_ylabel("IoU",fontsize=16)
        ax.set_xlabel("Index",fontsize=16)
        red_patch = mpatches.Patch(color='red', label='FMM')
        blue_patch = mpatches.Patch(color='blue', label='AC')
        ax.legend(handles=[blue_patch,red_patch])
        ax.yaxis.set_major_locator(MultipleLocator(0.1))
        ax.yaxis.set_minor_locator(MultipleLocator(0.05))
        ax.grid(which='both')
        plt.savefig("Graphs/"+INPUT_FOLDER+"_iou_graph.png",bbox_inches='tight',pad_inches=0.01)
        print("\\begin{figure}[h!]")
        print("\\centering")
        print("\\includegraphics[width=0.9\linewidth]{img/"+INPUT_FOLDER+"_iou_graph.png}")
        print("\\caption{"+INPUT_FOLDER+" - Intersection over Union}")
        print("\\label{fig:"+INPUT_FOLDER+"_iou_graph}")
        print("\\end{figure}")
        print("")
        fig,ax = plt.subplots(1,1)
        ax.plot(x, longerr_fmm, 'ro--', linewidth=1, markersize=5)
        ax.plot(x, longerr_ac, 'bo--', linewidth=1, markersize=5)
        ax.set_xlim((1, n))
        ax.set_ylim(bottom=0)
        ax.set_xticks(x)
        ax.yaxis.set_major_formatter(PercentFormatter())
        ax.set_ylabel("Long-axis relative error",fontsize=16)
        ax.set_xlabel("Index",fontsize=16)
        red_patch = mpatches.Patch(color='red', label='FMM')
        blue_patch = mpatches.Patch(color='blue', label='AC')
        ax.legend(handles=[blue_patch,red_patch])
        ax.yaxis.set_major_locator(MultipleLocator(20))
        ax.yaxis.set_minor_locator(MultipleLocator(10))
        ax.grid(which='both')
        plt.savefig("Graphs/"+INPUT_FOLDER+"_longerr_graph.png",bbox_inches='tight',pad_inches=0.01)
        print("\\begin{figure}[h!]")
        print("\\centering")
        print("\\includegraphics[width=0.9\linewidth]{img/"+INPUT_FOLDER+"_longerr_graph.png}")
        print("\\caption{"+INPUT_FOLDER+" - Long-axis relative error}")
        print("\\label{fig:"+INPUT_FOLDER+"_longerr_graph}")
        print("\\end{figure}")
        print("")
        fig,ax = plt.subplots(1,1)
        ax.plot(x, shorterr_fmm, 'ro--', linewidth=1, markersize=5)
        ax.plot(x, shorterr_ac, 'bo--', linewidth=1, markersize=5)
        ax.set_xlim((1, n))
        ax.set_ylim(bottom=0)
        ax.set_xticks(x)
        ax.yaxis.set_major_formatter(PercentFormatter())
        ax.set_ylabel("Short-axis relative error",fontsize=16)
        ax.set_xlabel("Index",fontsize=16)
        red_patch = mpatches.Patch(color='red', label='FMM')
        blue_patch = mpatches.Patch(color='blue', label='AC')
        ax.legend(handles=[blue_patch,red_patch])
        ax.yaxis.set_major_locator(MultipleLocator(20))
        ax.yaxis.set_minor_locator(MultipleLocator(10))
        ax.grid(which='both')
        plt.savefig("Graphs/"+INPUT_FOLDER+"_shorterr_graph.png",bbox_inches='tight',pad_inches=0.01)
        print("\\begin{figure}[h!]")
        print("\\centering")
        print("\\includegraphics[width=0.9\linewidth]{img/"+INPUT_FOLDER+"_shorterr_graph.png}")
        print("\\caption{"+INPUT_FOLDER+" - Short-axis relative error}")
        print("\\label{fig:"+INPUT_FOLDER+"_shorterr_graph}")
        print("\\end{figure}")
        print("")
